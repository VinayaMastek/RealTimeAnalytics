<!DOCTYPE html>
<html>
<head>
<meta charset="ISO-8859-1">
<title>Motor Insurance Quote</title>
<link rel="stylesheet"
	href="//code.jquery.com/ui/1.10.4/themes/smoothness/jquery-ui.css">
<link rel="stylesheet" type="text/css" media="all" href="css/style.css" />

<script type="text/javascript" src="js/jquery.js"></script>
<script src="//code.jquery.com/ui/1.10.4/jquery-ui.js"></script>


<script type="text/javascript">
	var accountid;
	var owner;
	var transactionid = null;

	$(document)
			.ready(
					function() {
						var createbtn = document
								.getElementById('CreateContact');
						var getQuotebtn = document.getElementById('GetQuote');

						// Capture Change Event
						var tranidvar = document
								.getElementById('select_tran');

						var totfieldchange = document
								.getElementById('TotFieldChange');
						
						
						var tothours = document
						.getElementById('TotHours');

						var totmin = document
						.getElementById('TotMin');
						var totsec = document
						.getElementById('TotSec');

						
						var totamounttime = document
						.getElementById('TotAmountTime');
						var totnameemail = document
						.getElementById('TotNameEmail');
						var totnamechange = document
						.getElementById('TotNameChange');
						
						
						
						
						
						
						//var transactionid = "222";
						var payload = {};
						var time=0;
						fetchTran();


						tranidvar.addEventListener('change',
								function(event) {

							   transactionid=tranidvar.value;
							   console.log('Tran is' + transactionid);
					           var url = 'http://localhost:8080/MedicalTextAnalysis/rest/textanalysis/annotatePDFwithmedicalterms?files=D:/workspace/MedicalTextAnalysis/DocRepository/Test eSAR.pdf;';
					            //var url = 'http://localhost:8080/MedicalTextAnalysis/rest/textanalysis/annotatePDFwithmedicalterms?files=https://www.dropbox.com/s/2560uwq4dnvlo8g/medic1.txt?dl=1;';
					            jQuery.support.cors = true;
					            $.ajax(
					                {
					                    type: 'GET',
					                    url:url,
					                    data: '{}',
					                    contentType: 'application/json; charset=utf-8',
					                    dataType: 'json',

					                    error: function (data) {

					                    	
					                    	
/*---*/					                    	
											if ("WebSocket" in window) {
												console
														.log('WebSocket is supported by your browser.');
												/* var serviceUrl = 'ws://'
														+ 'mastekinnovation.com:8080'
														+ '/EventProcessingAPI/websocket/notifyAnnotation?transactionid=ad'
														+ transactionid;
					 */
												 var serviceUrl = 'ws://'
												 + 'localhost:8080'
												 + '/EventProcessingAPI/websocket/notifyAnnotation?transactionid=ad'
												 + transactionid;
					 
					 							console.log(serviceUrl);
						 						var socket = new WebSocket(serviceUrl);
												socket.onopen = function() {
													console.log('Connection Established!');
												};

												socket.onclose = function() {
													console.log('Connection Closed!');
												};

												socket.onerror = function(error) {
													console.log('Error Occured: ' + error);
												};

												
												
												socket.onmessage = function(e) {
													if (typeof e.data === "string") {
														console.log('String message received: '
																+ e.data);

														if ((e.data.indexOf("Connection") < 0) ) {
															var json = JSON.parse(e.data);
															
															if (json.action != "NOACTION")
															{

															console.log("json is " + json);
															console.log("action is " + json.action);
				  						                   	$('#eventlog > tbody:last').append('<tr>');
										                	$('#eventlog > tbody:last').append('<td>' + json.msg+ '</td>');
										                	$('#eventlog > tbody:last').append('<td>' + json.action+ '</td>');
										                	$('#eventlog > tbody:last').append('</tr>');

															}
															else {
																
																totfieldchange.value = json.msg.split(":")[1]
															}
															
															if (json.action == "TIMESPENT")
																{
																	console.log("aaa "+ json.msg);
																	tothours.value = (json.msg.split("is :")[1]).split("Hours")[0];
																	totmin.value = (json.msg.split("is :")[1]).split("Hours")[1].split("Minutes")[0];
																	totsec.value = (json.msg.split("is :")[1]).split("Hours")[1].split("Minutes")[1].split("Seconds")[0];
																	
																}
															if (json.action == "APPUI_ACCEPT_PASSPORT")
															{
																totnamechange.value = json.msg.split("than ")[1].split("times")[0];
																
															}
															
															if (json.action == "INCREASE_RISK")
															{
																totnameemail.value = "Yes - changed"
																
															}

															
															
															}

													} else if (e.data instanceof ArrayBuffer) {
														console.log('ArrayBuffer received: '
																+ e.data);
													} else if (e.data instanceof Blob) {
														console.log('Blob received: ' + e.data);
													} else
														console.log('Unknown: ' + e.data);
												};
											}

/*---*/					                    	
					                    	
					                    	
					                    	
					               }
					                    });

							
							
							
						}); 

						


					});

	$(function() {
		$('input[name="radioowner"]').change(function() {
			owner = $(this).next('label').text();
		})
	});

	$(function() {
		$("#ApplicantDOB").datepicker();
	});

	$(function() {
		$("#PassportDT").datepicker();
	});

	function toggle_visibility(id) {
		document.getElementById(id).setAttribute("disabled", true);

	}

	function openWindow(windowUrl) {
		jQuery.support.cors = true;
		window.open(windowUrl, 'Connect', 'width=675,height=524').focus();
	};

	function getAuthorizeUrl(loginUrl, clientId, redirectUri) {
		return loginUrl + 'services/oauth2/authorize?display=popup'
				+ '&response_type=token&client_id=' + escape(clientId)
				+ '&redirect_uri=' + escape(redirectUri);
	}

	function isTrue(value) {
		if (typeof (value) == 'string') {
			value = value.toLowerCase();
		}
		switch (value) {
		case true:
		case "true":
		case 1:
		case "1":
		case "on":
		case "yes":
			return true;
		default:
			return false;
		}
	}

	function fetchTran() {
		$
				.ajax({
					type : 'GET',
					//url : 'http://mastekinnovation.com:8080/EventProcessingAPI/rest/events/opentran',
					url : 'http://localhost:8080/EventProcessingAPI/rest/events/fetchtran',
					contentType : "application/json; charset=utf-8",
					dataType : "json",
					async : false,
					success : function(data) {
						console.log("tttttt12345");
						console.log(data["output"]);

							var jsonData ; 
							var data1=data["output"].split(",");
						
						var combo = document.getElementById("select_tran");
						console.log(data1[0]);
						     
						for (i in data1)
							{
							console.log(data1[i]);
							jsonData = JSON.parse(data1[i])
						    var option = document.createElement("option");
						    option.text = jsonData["tran"];
						    option.value = jsonData["tran"];
						    try {
						        combo.add(option, null); //Standard 
						    }catch(error) {
						        combo.add(option); // IE only
						    }
							
							}
						transactionid = data.tranid;

					},
					error : function(msg) {
						alert(msg.responseText);
					}

				});

	}

	function createEvent(event, payload) {
		eventObj = {}
		eventObj['event'] = event;
		eventObj['timestamp'] = Date.now();
		eventObj['payload'] = payload;
		console.log(eventObj);
		$
				.ajax({
					type : 'POST',
					//url : 'http://mastekinnovation.com:8080/EventProcessingAPI/rest/events/eventpost',
					url : 'http://localhost:8080/EventProcessingAPI/rest/events/eventpost',
					data : JSON.stringify(eventObj),
					contentType : "application/json; charset=utf-8",
					dataType : "json",
					async : true,
					error : function(msg) {
						alert(msg.responseText);
					}
				});

	}

	function createContact() {
		var contactObj = {};
		contactObj['firstName'] = $(this).attr('ApplicantFName').value;
		contactObj['lastName'] = $(this).attr('ApplicantLName').value;

		var st = $(this).attr('ApplicantDOB').value;
		var pattern = /(\d{2})\/(\d{2})\/(\d{4})/;
		var dt = new Date(st.replace(/(\d{2})\/(\d{2})\/(\d{4})/, '$3-$2-$1'));

		contactObj['birthdate'] = dt.toISOString()
		contactObj['maritalStatus'] = $(this).attr('select_marital').options[$(
				this).attr('select_marital').selectedIndex].text;
		contactObj['Salutation'] = $(this).attr('select_title').options[$(this)
				.attr('select_title').selectedIndex].text;
		contactObj['zipcode'] = $(this).attr('pincode').value;
		contactObj['emailid'] = $(this).attr('emailid').value;

		client.create('Contact', contactObj, function(response) {
			$('#message3').html('Contact Creation Successful');
		}, function(error) {
			console.log(error);
		});

	}
</script>
<script type="text/javascript">
	$(document).ready(function() {
		//  When user clicks on tab, this code will be executed

		$("#tabs li").click(function() {
			//  First remove class "active" from currently active tab
			$("#tabs li").removeClass('tabactive');

			//  Now add class "active" to the selected/clicked tab
			$(this).addClass("tabactive");

			//  Hide all tab content
			$(".tab_content").hide();

			//  Here we get the href value of the selected tab
			var selected_tab = $(this).find("a").attr("href");

			//  Show the selected tab content
			$(selected_tab).fadeIn();

			//  At the end, we add return false so that the click on the link is not executed
			return false;
		});
	});
</script>

</head>

<body>
	<form id="adminform" name="adminform">
			<!--Header Start Here-->
			<div id="header">

				<div class="pull-left logo">
					<a href="#">Monitoring</a>
				</div>
				<div class="pull-left navigation">
					<div id="main-nav"></div>
				</div>
				<div class="pull-right userNav"></div>
				<div id="main">
					<div id="message1"></div>
					<div id="message2"></div>
					<table id="fields">
					</table>
				</div>
			</div>
			<div class="content">
				<div id="center-wrapper">
					<div id="mySocket" class="sidebarLeft pull-left">
						<h2 align="center">Event History</h2>
     					<div class = "spacer"></div>

			       			<table id="eventlog">
		        	  		<tbody>
		        	  		
			        			<tr>
			        			<th>Event</th>
			        			<th>Action</th>
			        			</tr>
			        		</tbody>
		        			</table>  		
        				<div class = "spacer"></div>


					</div>

					<!--Main content start Here-->
					<div class="centerContent pull-left">
						<h1>Monitor Website events</h1>
						<h2>Input Click Stream, Output Event Pattern, Recommendations</h2>

						<div class="formElement">
							<label for="TransactionID" class="bold"><span
								class="mandatorStar">*</span> Transaction ID&nbsp;</label>
							<div class="MT1">
								<div class=" mediumW pull-left MR5">
									<select id="select_tran" name="select_tran"
										class="input_full" tabindex="1">
									</select> <span class="hint">Select ID</span>
								</div>
							</div>
							<div class="CL"></div>
						</div>

						<div class="formElement">
							<div class="mediumW pull-left MR5">
								<label class="bold" for="TransactionID"><span
									class="mandatorStar">*</span> Total Field Changes </label>
								<div class="MT1">
									<input type="text" class="input_full_wrap pull-left"
										tabindex="4" name="TotFieldChange" id="TotFieldChange">

								</div>
							</div>

						

						
					</div>

						<div class="formElement">
							<div class="mediumW pull-left MR5">
								<label class="bold" for="TotalTimeSpent"><span
									class="mandatorStar">*</span> Total Time Spent </label>
								<div class="MT1">
									<input type="text" class="input_full_wrap pull-left"
										tabindex="4" name="TotHours" id="TotHours">
										<span class="hint">Hours</span>
								</div>
								
								<div class="MT1">
									<input type="text" class="input_full_wrap pull-left"
										tabindex="4" name="TotMin" id="TotMin">
										<span class="hint">Minutes</span>

								</div>
								<div class="MT1">
									<input type="text" class="input_full_wrap pull-left"
										tabindex="4" name="TotSec" id="TotSec">
										<span class="hint">Seconds</span>

								</div>
								
							</div>

						

						

							<div class="mediumW pull-left MR5">
								<label class="bold" for="TransactionID"><span
									class="mandatorStar">*</span> Suspicious Activities </label>
								<div class="MT1">
									<input type="text" class="input_full_wrap pull-left"
										tabindex="4" name="TotNameChange" id="TotNameChange">
										<span class="hint">Too many name changes - count</span>
								</div>
								
								<div class="MT1">
									<input type="text" class="input_full_wrap pull-left"
										tabindex="4" name="TotNameEmail" id="TotNameEmail">
										<span class="hint">Did Name changed after E-mail?</span>

								</div>
								<div class="MT1">
									<input type="text" class="input_full_wrap pull-left"
										tabindex="4" name="TotAmountTime" id="TotAmountTime">
										<span class="hint">Long time spent on Amount - time</span>

								</div>
								
							</div>

						

						
					</div>



				</div>
			</div>
		</div>
	</form>
</body>
</html>
